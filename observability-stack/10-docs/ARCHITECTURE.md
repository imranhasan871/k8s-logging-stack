# Architecture Documentation

## System Overview

The observability stack consists of three main components working together to provide comprehensive logging, monitoring, and visualization capabilities for Kubernetes clusters.

```
┌─────────────────────────────────────────────────────────────────────────────────────┐
│                           Kubernetes Cluster                                       │
├─────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                     │
│  ┌─────────────────────────────────────────────────────────────────────────────┐    │
│  │                          Observability Namespace                            │    │
│  │                                                                             │    │
│  │  ┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐          │    │
│  │  │    Grafana      │    │      Loki       │    │  Grafana Alloy  │          │    │
│  │  │                 │    │                 │    │                 │          │    │
│  │  │  ┌───────────┐  │    │  ┌───────────┐  │    │  ┌───────────┐  │          │    │
│  │  │  │Dashboard  │  │    │  │Distributor│  │    │  │Metrics    │  │          │    │
│  │  │  │Engine     │  │    │  └───────────┘  │    │  │Collector  │  │          │    │
│  │  │  └───────────┘  │    │  ┌───────────┐  │    │  └───────────┘  │          │    │
│  │  │  ┌───────────┐  │    │  │Ingester   │  │    │  ┌───────────┐  │          │    │
│  │  │  │Data       │◄─┼────┼──┤           │  │    │  │Logs       │  │          │    │
│  │  │  │Sources    │  │    │  └───────────┘  │    │  │Collector  │  │          │    │
│  │  │  └───────────┘  │    │  ┌───────────┐  │    │  └───────────┘  │          │    │
│  │  │  ┌───────────┐  │    │  │Querier    │  │    │  ┌───────────┐  │          │    │
│  │  │  │Alerting   │  │    │  └───────────┘  │    │  │Discovery  │  │          │    │
│  │  │  │Engine     │  │    │  ┌───────────┐  │    │  │Engine     │  │          │    │
│  │  │  └───────────┘  │    │  │Query      │  │    │  └───────────┘  │          │    │
│  │  └─────────────────┘    │  │Frontend   │  │    └─────────────────┘          │    │
│  │           ▲              │  └───────────┘  │             │                   │    │
│  │           │              └─────────────────┘             │                   │    │
│  │           │                       ▲                     │                   │    │
│  │           │                       │                     ▼                   │    │
│  │           └───────────────────────┼─────────────────────────────────────────┘    │
│  │                                   │                                              │
│  ├───────────────────────────────────┼──────────────────────────────────────────────┤
│  │                                   │                                              │
│  │  ┌─────────────────────────────────▼──────────────────────────────────────┐      │
│  │  │                        Storage Layer                                   │      │
│  │  │                                                                        │      │
│  │  │  ┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐     │      │
│  │  │  │   Grafana PVC   │    │    Loki PVC     │    │   Object Store  │     │      │
│  │  │  │   (Dashboards   │    │   (WAL/Index)   │    │   (MinIO/S3)    │     │      │
│  │  │  │    & Config)    │    │                 │    │   (Log Chunks)  │     │      │
│  │  │  └─────────────────┘    └─────────────────┘    └─────────────────┘     │      │
│  │  └────────────────────────────────────────────────────────────────────────┘      │
│  │                                                                                   │
│  └───────────────────────────────────────────────────────────────────────────────────┘
└─────────────────────────────────────────────────────────────────────────────────────┘
```

## Component Architecture

### Grafana Alloy

**Purpose:** Modern observability agent for collecting logs and metrics

**Architecture:**
```
┌─────────────────────────────────────────────────────────────┐
│                    Grafana Alloy                           │
├─────────────────────────────────────────────────────────────┤
│  ┌─────────────────────────────────────────────────────┐    │
│  │               Discovery Layer                       │    │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  │    │
│  │  │ Kubernetes  │  │  File       │  │  Service    │  │    │
│  │  │ Discovery   │  │ Discovery   │  │ Discovery   │  │    │
│  │  └─────────────┘  └─────────────┘  └─────────────┘  │    │
│  └─────────────────────────────────────────────────────┘    │
│  ┌─────────────────────────────────────────────────────┐    │
│  │               Processing Layer                      │    │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  │    │
│  │  │   Parser    │  │   Filter    │  │  Transform  │  │    │
│  │  │             │  │             │  │             │  │    │
│  │  └─────────────┘  └─────────────┘  └─────────────┘  │    │
│  └─────────────────────────────────────────────────────┘    │
│  ┌─────────────────────────────────────────────────────┐    │
│  │                Output Layer                         │    │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  │    │
│  │  │    Loki     │  │ Prometheus  │  │   Remote    │  │    │
│  │  │   Writer    │  │  Writer     │  │   Writer    │  │    │
│  │  └─────────────┘  └─────────────┘  └─────────────┘  │    │
│  └─────────────────────────────────────────────────────┘    │
└─────────────────────────────────────────────────────────────┘
```

**Key Features:**
- Kubernetes-native service discovery
- Automatic log parsing (JSON, CRI, etc.)
- Built-in filtering and transformation
- Multiple output destinations
- Self-monitoring and health checks

**Deployment Model:**
- **DaemonSet**: Runs on every node for log collection
- **Host Network**: Access to node's log files
- **Privileged**: Read access to container logs

### Loki

**Purpose:** Log aggregation system optimized for Kubernetes

**Architecture:**
```
┌─────────────────────────────────────────────────────────────┐
│                        Loki                                 │
├─────────────────────────────────────────────────────────────┤
│  ┌─────────────────────────────────────────────────────┐    │
│  │                 Ingestion Path                      │    │
│  │                                                     │    │
│  │  ┌─────────────┐    ┌─────────────────────────────┐  │    │
│  │  │Distributor  │───▶│         Ingester            │  │    │
│  │  │             │    │                             │  │    │
│  │  │• Validation │    │• Index Creation             │  │    │
│  │  │• Rate Limit │    │• Chunk Creation             │  │    │
│  │  │• Hash Ring  │    │• Local Storage (WAL)        │  │    │
│  │  └─────────────┘    └─────────────────────────────┘  │    │
│  └─────────────────────────────────────────────────────┘    │
│  ┌─────────────────────────────────────────────────────┐    │
│  │                 Query Path                          │    │
│  │                                                     │    │
│  │  ┌─────────────┐    ┌─────────────────────────────┐  │    │
│  │  │Query        │───▶│         Querier             │  │    │
│  │  │Frontend     │    │                             │  │    │
│  │  │             │    │• Index Lookup               │  │    │
│  │  │• Query Split│    │• Chunk Retrieval            │  │    │
│  │  │• Cache      │    │• Log Streaming              │  │    │
│  │  │• Dedup      │    │• Metric Queries             │  │    │
│  │  └─────────────┘    └─────────────────────────────┘  │    │
│  └─────────────────────────────────────────────────────┘    │
│  ┌─────────────────────────────────────────────────────┐    │
│  │                Storage Layer                        │    │
│  │                                                     │    │
│  │  ┌─────────────┐    ┌─────────────────────────────┐  │    │
│  │  │   Index     │    │        Object Store         │  │    │
│  │  │ (BoltDB)    │    │                             │  │    │
│  │  │             │    │• Log Chunks (MinIO/S3)      │  │    │
│  │  │• Time-based │    │• Immutable Storage          │  │    │
│  │  │• Compressed │    │• Configurable Retention     │  │    │
│  │  └─────────────┘    └─────────────────────────────┘  │    │
│  └─────────────────────────────────────────────────────┘    │
└─────────────────────────────────────────────────────────────┘
```

**Key Features:**
- Label-based indexing (not full-text)
- Horizontal scaling capability
- Time-series optimized storage
- LogQL query language
- Grafana integration

**Storage Strategy:**
- **Index**: BoltDB for label indexes
- **Chunks**: Object storage for log data
- **WAL**: Write-ahead log for reliability
- **Retention**: Configurable data lifecycle

### Grafana

**Purpose:** Visualization and dashboarding platform

**Architecture:**
```
┌─────────────────────────────────────────────────────────────┐
│                      Grafana                                │
├─────────────────────────────────────────────────────────────┤
│  ┌─────────────────────────────────────────────────────┐    │
│  │               Frontend Layer                        │    │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  │    │
│  │  │   React     │  │   Angular   │  │    Web      │  │    │
│  │  │     UI      │  │   Panels    │  │  Components │  │    │
│  │  └─────────────┘  └─────────────┘  └─────────────┘  │    │
│  └─────────────────────────────────────────────────────┘    │
│  ┌─────────────────────────────────────────────────────┐    │
│  │               Backend Layer                         │    │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  │    │
│  │  │    API      │  │   Query     │  │  Alerting   │  │    │
│  │  │   Server    │  │  Engine     │  │   Engine    │  │    │
│  │  └─────────────┘  └─────────────┘  └─────────────┘  │    │
│  └─────────────────────────────────────────────────────┘    │
│  ┌─────────────────────────────────────────────────────┐    │
│  │              Data Source Layer                      │    │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  │    │
│  │  │    Loki     │  │ Prometheus  │  │   Other     │  │    │
│  │  │ Connector   │  │ Connector   │  │ Connectors  │  │    │
│  │  └─────────────┘  └─────────────┘  └─────────────┘  │    │
│  └─────────────────────────────────────────────────────┘    │
│  ┌─────────────────────────────────────────────────────┐    │
│  │               Storage Layer                         │    │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  │    │
│  │  │ Dashboards  │  │    Users    │  │   Config    │  │    │
│  │  │   (JSON)    │  │  & Orgs     │  │  & Prefs    │  │    │
│  │  └─────────────┘  └─────────────┘  └─────────────┘  │    │
│  └─────────────────────────────────────────────────────┘    │
└─────────────────────────────────────────────────────────────┘
```

**Key Features:**
- Multiple data source support
- Rich visualization options
- Alert management
- User and organization management
- Plugin ecosystem

## Data Flow

### Log Collection Flow

```
┌─────────────────────────────────────────────────────────────────────────────────────┐
│                              Log Collection Data Flow                               │
├─────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                     │
│  ┌─────────────┐                                                                    │
│  │Application  │                                                                    │
│  │Container    │                                                                    │
│  │Logs         │                                                                    │
│  └──────┬──────┘                                                                    │
│         │                                                                           │
│         ▼                                                                           │
│  ┌─────────────┐                                                                    │
│  │  Docker     │                                                                    │
│  │  Log        │                                                                    │
│  │  Driver     │                                                                    │
│  └──────┬──────┘                                                                    │
│         │                                                                           │
│         ▼                                                                           │
│  ┌─────────────┐     ┌─────────────┐     ┌─────────────┐     ┌─────────────┐       │
│  │/var/log/    │────▶│   Grafana   │────▶│    Loki     │────▶│   Object    │       │
│  │pods/        │     │    Alloy    │     │ Distributor │     │   Storage   │       │
│  │*.log        │     │             │     │             │     │  (MinIO)    │       │
│  └─────────────┘     └─────────────┘     └─────────────┘     └─────────────┘       │
│         │                    │                   │                   ▲             │
│         │                    ▼                   ▼                   │             │
│         │             ┌─────────────┐     ┌─────────────┐             │             │
│         │             │Log Pipeline │     │    Loki     │             │             │
│         │             │             │     │  Ingester   │─────────────┘             │
│         │             │• Parse      │     │             │                           │
│         │             │• Filter     │     │• Index      │                           │
│         │             │• Transform  │     │• Chunk      │                           │
│         │             │• Enrich     │     │• Compress   │                           │
│         │             └─────────────┘     └─────────────┘                           │
│         │                    │                   │                                 │
│         │                    ▼                   ▼                                 │
│         │             ┌─────────────┐     ┌─────────────┐                           │
│         │             │   Labels    │     │Local Storage│                           │
│         │             │             │     │(WAL & Index)│                           │
│         │             │• namespace  │     └─────────────┘                           │
│         │             │• pod        │                                               │
│         │             │• container  │                                               │
│         │             │• level      │                                               │
│         │             └─────────────┘                                               │
│         │                                                                           │
│         ▼                                                                           │
│  ┌─────────────┐                                                                    │
│  │  Kubernetes │                                                                    │
│  │  Metadata   │                                                                    │
│  │             │                                                                    │
│  │• Node       │                                                                    │
│  │• Namespace  │                                                                    │
│  │• Pod        │                                                                    │
│  │• Container  │                                                                    │
│  └─────────────┘                                                                    │
│                                                                                     │
└─────────────────────────────────────────────────────────────────────────────────────┘
```

### Query Flow

```
┌─────────────────────────────────────────────────────────────────────────────────────┐
│                              Query Data Flow                                        │
├─────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                     │
│  User Query ──▶ Grafana ──▶ Loki Query Frontend ──▶ Loki Querier ──▶ Object Store │
│       ▲                                                    │                       │
│       │                                                    ▼                       │
│       │                                             ┌─────────────┐                │
│       │                                             │   Index     │                │
│       │                                             │   Lookup    │                │
│       │                                             └─────────────┘                │
│       │                                                    │                       │
│       │                                                    ▼                       │
│       │                                             ┌─────────────┐                │
│       │                                             │   Chunk     │                │
│       │                                             │ Retrieval   │                │
│       │                                             └─────────────┘                │
│       │                                                    │                       │
│       │                                                    ▼                       │
│       │                                             ┌─────────────┐                │
│       │                                             │    Log      │                │
│       │                                             │  Filtering  │                │
│       │                                             └─────────────┘                │
│       │                                                    │                       │
│       │                                                    ▼                       │
│       └────────────────── Query Results ◄─────────── ┌─────────────┐                │
│                                                      │ Aggregation │                │
│                                                      │ & Sorting   │                │
│                                                      └─────────────┘                │
│                                                                                     │
└─────────────────────────────────────────────────────────────────────────────────────┘
```

## Storage Architecture

### Loki Storage Model

```
┌─────────────────────────────────────────────────────────────────────────────────────┐
│                            Loki Storage Architecture                                │
├─────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                     │
│  ┌─────────────────────────────────────────────────────────────────────────────┐    │
│  │                        Time-based Partitioning                             │    │
│  │                                                                             │    │
│  │  Day 1        │  Day 2        │  Day 3        │  Day N                      │    │
│  │ ┌───────────┐ │ ┌───────────┐ │ ┌───────────┐ │ ┌───────────┐               │    │
│  │ │   Index   │ │ │   Index   │ │ │   Index   │ │ │   Index   │               │    │
│  │ │  BoltDB   │ │ │  BoltDB   │ │ │  BoltDB   │ │ │  BoltDB   │               │    │
│  │ └───────────┘ │ └───────────┘ │ └───────────┘ │ └───────────┘               │    │
│  │ ┌───────────┐ │ ┌───────────┐ │ ┌───────────┐ │ ┌───────────┐               │    │
│  │ │   Chunks  │ │ │   Chunks  │ │ │   Chunks  │ │ │   Chunks  │               │    │
│  │ │ (MinIO/S3)│ │ │ (MinIO/S3)│ │ │ (MinIO/S3)│ │ │ (MinIO/S3)│               │    │
│  │ └───────────┘ │ └───────────┘ │ └───────────┘ │ └───────────┘               │    │
│  └─────────────────────────────────────────────────────────────────────────────┘    │
│                                                                                     │
│  ┌─────────────────────────────────────────────────────────────────────────────┐    │
│  │                        Label-based Indexing                                │    │
│  │                                                                             │    │
│  │  Label Set 1: {namespace="default", pod="app-1"}                           │    │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐                         │    │
│  │  │   Chunk 1   │  │   Chunk 2   │  │   Chunk N   │                         │    │
│  │  │ 10:00-10:15 │  │ 10:15-10:30 │  │ 10:30-10:45 │                         │    │
│  │  └─────────────┘  └─────────────┘  └─────────────┘                         │    │
│  │                                                                             │    │
│  │  Label Set 2: {namespace="default", pod="app-2"}                           │    │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐                         │    │
│  │  │   Chunk A   │  │   Chunk B   │  │   Chunk C   │                         │    │
│  │  │ 10:00-10:15 │  │ 10:15-10:30 │  │ 10:30-10:45 │                         │    │
│  │  └─────────────┘  └─────────────┘  └─────────────┘                         │    │
│  └─────────────────────────────────────────────────────────────────────────────┘    │
│                                                                                     │
│  ┌─────────────────────────────────────────────────────────────────────────────┐    │
│  │                      Retention Lifecycle                                   │    │
│  │                                                                             │    │
│  │  ┌─────────────┐    ┌─────────────┐    ┌─────────────┐                      │    │
│  │  │   Active    │───▶│  Compacted  │───▶│   Deleted   │                      │    │
│  │  │             │    │             │    │             │                      │    │
│  │  │• WAL        │    │• Merged     │    │• Expired    │                      │    │
│  │  │• Memory     │    │• Compressed │    │• Cleanup    │                      │    │
│  │  │• Real-time  │    │• Archived   │    │             │                      │    │
│  │  └─────────────┘    └─────────────┘    └─────────────┘                      │    │
│  │      < 1 hour           1-30 days          > 30 days                       │    │
│  └─────────────────────────────────────────────────────────────────────────────┘    │
└─────────────────────────────────────────────────────────────────────────────────────┘
```

## Network Architecture

### Service Communication

```
┌─────────────────────────────────────────────────────────────────────────────────────┐
│                           Network Architecture                                      │
├─────────────────────────────────────────────────────────────────────────────────────┤
│                                                                                     │
│  ┌─────────────────────────────────────────────────────────────────────────────┐    │
│  │                          Ingress Layer                                     │    │
│  │                                                                             │    │
│  │  ┌─────────────┐    ┌─────────────┐    ┌─────────────┐                      │    │
│  │  │   NGINX     │───▶│   Grafana   │    │    MinIO    │                      │    │
│  │  │  Ingress    │    │ grafana.    │    │ minio.      │                      │    │
│  │  │ Controller  │    │ local:3000  │    │ local:9001  │                      │    │
│  │  └─────────────┘    └─────────────┘    └─────────────┘                      │    │
│  └─────────────────────────────────────────────────────────────────────────────┘    │
│                                  │                                                 │
│                                  ▼                                                 │
│  ┌─────────────────────────────────────────────────────────────────────────────┐    │
│  │                      Service Layer                                          │    │
│  │                                                                             │    │
│  │  ┌─────────────┐    ┌─────────────┐    ┌─────────────┐                      │    │
│  │  │   Grafana   │───▶│    Loki     │◄───│   Alloy     │                      │    │
│  │  │ Service     │    │  Service    │    │  Service    │                      │    │
│  │  │ :3000       │    │  :3100      │    │  :12345     │                      │    │
│  │  └─────────────┘    └─────────────┘    └─────────────┘                      │    │
│  │         │                   │                   │                          │    │
│  │         ▼                   ▼                   ▼                          │    │
│  │  ┌─────────────┐    ┌─────────────┐    ┌─────────────┐                      │    │
│  │  │  Grafana    │    │    Loki     │    │   Alloy     │                      │    │
│  │  │    Pod      │    │    Pod      │    │ DaemonSet   │                      │    │
│  │  └─────────────┘    └─────────────┘    └─────────────┘                      │    │
│  └─────────────────────────────────────────────────────────────────────────────┘    │
│                                  │                                                 │
│                                  ▼                                                 │
│  ┌─────────────────────────────────────────────────────────────────────────────┐    │
│  │                      Storage Network                                       │    │
│  │                                                                             │    │
│  │  ┌─────────────┐                           ┌─────────────┐                  │    │
│  │  │    Loki     │──────── S3 API ─────────▶│    MinIO    │                  │    │
│  │  │             │     (Object Storage)      │             │                  │    │
│  │  │• Index      │                           │• Buckets    │                  │    │
│  │  │• Chunks     │                           │• Objects    │                  │    │
│  │  │• WAL        │                           │• Versioning │                  │    │
│  │  └─────────────┘                           └─────────────┘                  │    │
│  └─────────────────────────────────────────────────────────────────────────────┘    │
└─────────────────────────────────────────────────────────────────────────────────────┘
```

### Network Policies

```
┌─────────────────────────────────────────────────────────────┐
│                  Network Security                          │
├─────────────────────────────────────────────────────────────┤
│  Default: DENY ALL                                         │
│                                                             │
│  ┌─────────────────────────────────────────────────────┐    │
│  │                   Allowed Traffic                   │    │
│  │                                                     │    │
│  │  Ingress → Grafana      :3000                       │    │
│  │  Ingress → MinIO        :9001                       │    │
│  │  Grafana → Loki         :3100                       │    │
│  │  Alloy   → Loki         :3100                       │    │
│  │  Loki    → MinIO        :9000                       │    │
│  │  All     → DNS          :53                         │    │
│  │  All     → HTTPS        :443                        │    │
│  └─────────────────────────────────────────────────────┘    │
└─────────────────────────────────────────────────────────────┘
```

## Security Architecture

### RBAC Model

```
┌─────────────────────────────────────────────────────────────┐
│                    RBAC Structure                          │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  ┌─────────────────────────────────────────────────────┐    │
│  │               Service Account                       │    │
│  │            observability-stack                     │    │
│  └─────────────────┬───────────────────────────────────┘    │
│                    │                                       │
│                    ▼                                       │
│  ┌─────────────────────────────────────────────────────┐    │
│  │               Cluster Role                          │    │
│  │                                                     │    │
│  │  • nodes (get, list, watch)                        │    │
│  │  • services (get, list, watch)                     │    │
│  │  • endpoints (get, list, watch)                    │    │
│  │  • pods (get, list, watch)                         │    │
│  │  • configmaps (get, list, watch)                   │    │
│  │  • namespaces (get, list, watch)                   │    │
│  │  • /metrics (get)                                  │    │
│  └─────────────────────────────────────────────────────┘    │
│                    │                                       │
│                    ▼                                       │
│  ┌─────────────────────────────────────────────────────┐    │
│  │               Namespace Role                        │    │
│  │                                                     │    │
│  │  • configmaps (all)                                │    │
│  │  • secrets (all)                                   │    │
│  └─────────────────────────────────────────────────────┘    │
└─────────────────────────────────────────────────────────────┘
```

### Security Controls

1. **Pod Security Standards**
   - Non-root containers
   - Read-only root filesystem
   - Dropped capabilities
   - No privilege escalation

2. **Network Security**
   - Network policies for traffic isolation
   - Service mesh ready
   - TLS encryption for external traffic

3. **Secret Management**
   - Kubernetes secrets for credentials
   - Secret rotation capability
   - External secret management integration

4. **Resource Controls**
   - Resource quotas per namespace
   - Limit ranges for containers
   - Priority classes for scheduling

## Scalability Considerations

### Horizontal Scaling

```
┌─────────────────────────────────────────────────────────────┐
│                 Scaling Architecture                       │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  ┌─────────────────────────────────────────────────────┐    │
│  │                Grafana Scaling                     │    │
│  │                                                     │    │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  │    │
│  │  │  Grafana 1  │  │  Grafana 2  │  │  Grafana N  │  │    │
│  │  └─────────────┘  └─────────────┘  └─────────────┘  │    │
│  │          │               │               │          │    │
│  │          └───────────────┼───────────────┘          │    │
│  │                          ▼                          │    │
│  │                 ┌─────────────┐                     │    │
│  │                 │    LoadBalancer                   │    │
│  │                 └─────────────┘                     │    │
│  └─────────────────────────────────────────────────────┘    │
│                                                             │
│  ┌─────────────────────────────────────────────────────┐    │
│  │                 Loki Scaling                        │    │
│  │                                                     │    │
│  │  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  │    │
│  │  │    Read     │  │    Write    │  │   Backend   │  │    │
│  │  │ Components  │  │ Components  │  │ Components  │  │    │
│  │  │             │  │             │  │             │  │    │
│  │  │• Querier    │  │• Distributor│  │• Compactor  │  │    │
│  │  │• Query      │  │• Ingester   │  │• Ruler      │  │    │
│  │  │  Frontend   │  │             │  │• Store      │  │    │
│  │  └─────────────┘  └─────────────┘  └─────────────┘  │    │
│  └─────────────────────────────────────────────────────┘    │
│                                                             │
│  ┌─────────────────────────────────────────────────────┐    │
│  │               Alloy Scaling                         │    │
│  │                                                     │    │
│  │  Node 1         Node 2         Node N               │    │
│  │  ┌─────────┐     ┌─────────┐     ┌─────────┐         │    │
│  │  │  Alloy  │     │  Alloy  │     │  Alloy  │         │    │
│  │  │ Agent   │     │ Agent   │     │ Agent   │         │    │
│  │  └─────────┘     └─────────┘     └─────────┘         │    │
│  └─────────────────────────────────────────────────────┘    │
└─────────────────────────────────────────────────────────────┘
```

### Performance Optimization

1. **Loki Optimization**
   - Query parallelization
   - Index caching
   - Chunk compression
   - Query result caching

2. **Storage Optimization**
   - Object storage tiering
   - Index optimization
   - Retention policies
   - Compaction strategies

3. **Network Optimization**
   - Connection pooling
   - Compression
   - CDN integration
   - Regional deployments

This architecture provides a robust, scalable, and production-ready observability solution for Kubernetes environments.